<!DOCTYPE html>

<html>
<head>
<title>Live GPS Tracker v1.9 - NSW Topo + World Imagery</title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
<style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; width: 100%; z-index: 0; }

    #info {
      position: absolute;
      top: 10px;
      right: 10px;
      max-width: 340px;
      max-height: 70%;
      overflow-y: auto;
      background: rgba(255,255,255,0.85);
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
      font-size: 13px;
      color: #2C3E50;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    #info2 {
      position: absolute;
      top: 10px;
      right: 370px;
      max-width: 340px;
      max-height: 70%;
      overflow-y: auto;
      background: rgba(255,255,255,0.85);
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
      font-size: 13px;
      color: #2C3E50;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    #toggle-button, #toggle-button2 {
      background-color: #0078D7;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
      width: 100%;
    }
    
    #toggle-button:hover, #toggle-button2:hover {
      background-color: #005A9E;
    }

    #opacity-control {
      position: absolute;
      bottom: 60px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 6px;
      font-family: sans-serif;
      font-size: 12px;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    #opacity-control label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    #opacity-control input[type="range"] {
      width: 150px;
      margin-right: 10px;
    }

    .row-active { background-color: #D5F5E3; }
    .row-warm   { background-color: #FCF3CF; }
    .row-stale  { background-color: #FADBD8; }

    .row-low-sats {
      background-color: #F5B7B1 !important;
      animation: blink 1s step-start infinite;
    }

    @keyframes blink {
      50% { background-color: #FADBD8; }
    }

    .device-label {
      background: transparent;
      color: black;
      font-weight: bold;
      text-align: center;
      line-height: 24px;
      font-size: 11px;
    }

    .arrow-icon {
      font-weight: bold;
      font-size: 8px;
    }

    footer {
      position: absolute;
      bottom: 10px;
      left: 10px;
      font-size: 12px;
      color: #666;
      font-family: sans-serif;
      background-color: rgba(255,255,255,0.6);
      padding: 4px 8px;
      border-radius: 6px;
      z-index: 1001;
    }

    @keyframes pulse {
      0%   { background-color: #D5F5E3; }
      50%  { background-color: #ABEBC6; }
      100% { background-color: #D5F5E3; }
    }

    .row-active {
      animation: pulse 2s infinite;
    }

    #debug {
      position: absolute;
      bottom: 80px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 11px;
      max-width: 300px;
      z-index: 1001;
    }

    /* Animated dots on polyline */
    .animated-polyline {
      stroke-dasharray: 1, 14;
      stroke-linecap: round;
      animation: moveDots 4s linear infinite;
    }

    .trail-arrow {
      z-index: 1000;
      animation: moveArrowAlongTrail 4s linear infinite;
    }

    @keyframes moveArrowAlongTrail {
      0% {
        transform: translateX(-4px) translateY(-4px) rotate(var(--arrow-bearing));
        opacity: 0.7;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translateX(4px) translateY(4px) rotate(var(--arrow-bearing));
        opacity: 0.7;
      }
    }

    @keyframes moveDots {
      0% {
        stroke-dashoffset: 15;
      }
      100% {
        stroke-dashoffset: 0;
      }
    }

    @keyframes moveArrowAlongPath {
      0% {
        transform: translateX(-7px) translateY(-7px);
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translateX(7px) translateY(7px);
        opacity: 0.6;
      }
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 auto;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }
    
    th {
      background-color: #f8f9fa;
      font-weight: bold;
      color: #333;
      position: sticky;
      top: 0;
    }
    
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    
    tr:hover {
      background-color: #e6f3ff;
    }

    .hidden {
      display: none;
    }

    .row-number {
      background-color: #e9ecef;
      font-weight: bold;
    }

    /* Mobile responsive styles */
    @media (max-width: 768px) {
      #info {
        position: absolute;
        top: 10px;
        right: 10px;
        left: auto;
        max-width: none;
        width: calc(45% - 10px);
        max-height: 35%;
        font-size: 11px;
        padding: 6px;
      }

      #info2 {
        position: absolute;
        top: 50%;
        right: 10px;
        left: auto;
        max-width: none;
        width: calc(45% - 10px);
        max-height: 35%;
        font-size: 11px;
        padding: 6px;
      }

      #info strong, #info2 strong {
        font-size: 12px;
      }

      table {
        font-size: 10px;
      }

      th, td {
        padding: 4px 2px;
      }

      #toggle-button, #toggle-button2 {
        font-size: 12px;
        padding: 6px 12px;
      }

      #opacity-control {
        bottom: 60px;
        left: 10px;
        font-size: 10px;
        padding: 6px;
      }

      #debug {
        bottom: 120px;
        left: 10px;
        font-size: 9px;
        padding: 6px;
        max-width: 200px;
      }

      footer {
        bottom: 10px;
        left: 10px;
        font-size: 10px;
        padding: 2px 4px;
      }
    }

    /* Portrait phone adjustments */
    @media (max-width: 480px) and (orientation: portrait) {
      #info {
        max-height: 30%;
        font-size: 10px;
        width: calc(48% - 10px);
      }

      #info2 {
        top: 35%;
        max-height: 30%;
        font-size: 10px;
        width: calc(48% - 10px);
      }

      table {
        font-size: 9px;
      }

      th, td {
        padding: 3px 1px;
      }

      #toggle-button, #toggle-button2 {
        font-size: 11px;
        padding: 5px 10px;
      }

      #opacity-control {
        bottom: 60px;
        left: 10px;
        font-size: 9px;
        padding: 4px;
      }

      #debug {
        bottom: 110px;
        left: 10px;
        font-size: 8px;
        padding: 4px;
        max-width: 150px;
      }

      footer {
        font-size: 9px;
      }
    }

    /* Landscape phone adjustments */
    @media (max-width: 768px) and (orientation: landscape) {
      #info {
        position: absolute;
        top: 10px;
        right: 10px;
        left: auto;
        width: 220px;
        max-width: 220px;
        max-height: 40%;
      }

      #info2 {
        position: absolute;
        top: 50%;
        right: 10px;
        left: auto;
        width: 220px;
        max-width: 220px;
        max-height: 40%;
      }

      #opacity-control {
        bottom: 10px;
        left: 10px;
        font-size: 10px;
      }

      #debug {
        bottom: 60px;
        left: 10px;
        font-size: 9px;
        max-width: 180px;
      }
    }
    
  </style>
</head>
<body>
<div id="map"></div>
<div id="info">
<strong>üì° GPS MacksTrack Data (I-XV)</strong>
<button id="toggle-button" onclick="toggleTable()">Hide Table</button>
<table id="device-table">
<thead>
<tr>
<th>ID</th>
<th>Lat</th>
<th>Lon</th>
<th>Count</th>
<th>Sats</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div id="info2">
<strong>üì° GPS MacksTrack Data (XVI-XXVII)</strong>
<button id="toggle-button2" onclick="toggleTable2()">Hide Table</button>
<table id="device-table2">
<thead>
<tr>
<th>ID</th>
<th>Lat</th>
<th>Lon</th>
<th>Count</th>
<th>Sats</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div id="opacity-control">
<label for="opacity-slider">Base Layer Opacity:</label>
<input id="opacity-slider" max="1" min="0.1" step="0.1" type="range" value="1"/>
<span id="opacity-value">100%</span>
</div>
<div id="debug">
<strong>Debug Info:</strong><br/>
    Connected: <span id="socket-status">‚ùå</span><br/>
    Total Devices: <span id="device-count">0</span><br/>
    Total Points: <span id="point-count">0</span><br/>
    Last Update: <span id="last-update">never</span><br/>
    Current Zoom: <span id="current-zoom">13</span>
</div>
<footer>
    üöÄ Last Render Build: <span id="build-time">loading...</span>
</footer>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>

<script>
// Define custom SCU crest icon
const scuCrestIcon = L.icon({
    iconUrl: 'https://raw.githubusercontent.com/AnthonyMacks/gps_tracker/main/templates/scucrest.png',
    iconSize: [32, 32],
    iconAnchor: [16, 16],
});

// Apply the icon to starting points (example logic)
if (typeof deviceData !== 'undefined') {
    deviceData.forEach(device => {
        if (device.points && device.points.length > 0) {
            const startPoint = device.points[0];
            L.marker(startPoint, { icon: scuCrestIcon }).addTo(map);
        }
    });
}
</script></body>
</html>
